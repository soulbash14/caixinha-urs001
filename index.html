<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema MVC Caixinha - urs_001</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; color: white; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .card { background: white; color: #333; border-radius: 15px; width: 380px; padding: 25px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card shadow">
        <div id="view-login">
            <h4 class="fw-bold text-center mb-4">Acesso MVC</h4>
            <input type="text" id="user" class="form-control mb-2" placeholder="Usuário">
            <input type="password" id="pass" class="form-control mb-3" placeholder="Senha">
            <button class="btn btn-primary w-100" onclick="App.login()">Entrar</button>
        </div>

        <div id="view-dash" class="hidden">
            <h5 id="txt-boas-vindas">Olá!</h5>
            <div class="p-3 bg-light rounded mb-3 text-center">
                <small>Saldo em Conta</small>
                <h2 class="text-success fw-bold" id="txt-saldo">R$ 0,00</h2>
            </div>
            
            <label class="small">Editar Nome:</label>
            <div class="input-group mb-3">
                <input type="text" id="edit-nome" class="form-control form-control-sm">
                <button class="btn btn-dark btn-sm" onclick="App.update()">Salvar</button>
            </div>

            <button class="btn btn-outline-danger btn-sm w-100" onclick="location.reload()">Sair</button>
        </div>
    </div>

    <script>
        const API = 'SUA_NOVA_URL_DO_GOOGLE_AQUI';

        // Objeto Application (Controller da View)
        const App = {
            userId: null,

            async login() {
                const res = await this.request('login', {
                    user: document.getElementById('user').value,
                    pass: document.getElementById('pass').value
                });
                
                if(res.sucesso) {
                    this.userId = res.id;
                    this.renderDash(res);
                } else { alert(res.msg); }
            },

            renderDash(data) {
                document.getElementById('view-login').classList.add('hidden');
                document.getElementById('view-dash').classList.remove('hidden');
                document.getElementById('txt-boas-vindas').innerText = "Olá, " + data.nome;
                document.getElementById('txt-saldo').innerText = "R$ " + data.saldo.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                document.getElementById('edit-nome').value = data.nome;
            },

            async update() {
                const novoNome = document.getElementById('edit-nome').value;
                const res = await this.request('update', { id: this.userId, data: { nome: novoNome } });
                if(res.sucesso) alert(res.msg);
            },

            async request(action, payload) {
                try {
                    const r = await fetch(API, { method: 'POST', body: JSON.stringify({action, payload}) });
                    return await r.json();
                } catch(e) { return {sucesso: false, msg: "Erro na conexão"}; }
            }
        };
    </script>
</body>
</html>
